<div class="users-management">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1>Users Management</h1>
    <button class="btn btn-primary" (click)="onCreate()">
      <i class="bi bi-plus-circle"></i> Add User
    </button>
  </div>

  <!-- Search Form -->
  <div class="card mb-3">
    <div class="card-body">
      <form [formGroup]="formSearch" class="row g-3">
        <div class="col-md-4">
          <label for="emailInput" class="form-label">Email</label>
          <input 
            id="emailInput"
            type="email"
            class="form-control"
            placeholder="Search by email..."
            formControlName="email">
        </div>
        <div class="col-md-4">
          <label for="statusSelect" class="form-label">Status</label>
          <select id="statusSelect" class="form-select" formControlName="status">
            <option value="">All Status</option>
            <option value="ACTIVE">Active</option>
            <option value="INACTIVE">Inactive</option>
            <option value="PENDING">Pending</option>
          </select>
        </div>
        <div class="col-md-4 d-flex align-items-end gap-2">
          <button 
            type="button"
            class="btn btn-primary w-50"
            (click)="handleSearch()">
            <i class="bi bi-search"></i> Search
          </button>
          <button 
            type="button"
            class="btn btn-outline-secondary w-50"
            (click)="clearForm()">
            <i class="bi bi-arrow-clockwise"></i> Clear
          </button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">
      <div class="row align-items-center">
        <div class="col-md-6">
          <span class="text-muted">Total: {{ paginationConfig.totalElements }} users</span>
        </div>
        <div class="col-md-6 text-end">
          <div class="d-inline-flex gap-2 align-items-center">
            <label for="pageInput" class="form-label mb-0">Go to page:</label>
            <input 
              id="pageInput"
              type="number" 
              class="form-control form-control-sm" 
              style="width: 80px"
              formControlName="searchPage"
              placeholder="Page #"
              min="1"
              [max]="paginationConfig.totalPages"
              (keyup.enter)="handleSearchPage()">
            <button 
              class="btn btn-sm btn-outline-primary"
              (click)="handleSearchPage()">
              <i class="bi bi-arrow-right"></i>
            </button>
          </div>
        </div>
      </div>
    </div>
    <div class="card-body p-0">
      @if (loading) {
        <div class="text-center py-5">
          <div class="spinner-border text-primary"></div>
        </div>
      } @else {
        <div class="table-responsive">
          <table class="table table-hover mb-0">
            <thead>
              <tr>
                <th style="width: 50px; text-align: center;">STT</th>
                <th>User</th>
                <th>Email</th>
                <th>Roles</th>
                <th>Status</th>
                <th>Joined</th>
                <th style="width: 120px; text-align: center;">Actions</th>
              </tr>
            </thead>
            <tbody>
              @for (user of users; track user.id; let i = $index) {
                <tr>
                  <td style="text-align: center; font-weight: 500;">
                    {{ i + 1 + (paginationConfig.currentPage * paginationConfig.pageSize) }}
                  </td>
                  <td>
                    <div class="user-info">
                      <div class="user-avatar">
                        {{ user.email.charAt(0).toUpperCase() }}
                      </div>
                      <div>
                        <div class="fw-semibold">{{ user.fullName }}</div>
                        <small class="text-muted">{{ user.email }}</small>
                      </div>
                    </div>
                  </td>
                  <td>{{ user.email }}</td>
                  <td>
                    @for (role of user.roles; track role) {
                      <span class="badge bg-info me-1">{{ role }}</span>
                    }
                  </td>
                  <td>
                    <span class="badge" [ngClass]="user.status === 'ACTIVE' ? 'bg-success' : 'bg-warning'">
                      {{ user.status }}
                    </span>
                  </td>
                  <td>{{ user.createdAt | date: 'MMM d, y' }}</td>
                  <td style="text-align: center;">
                    <div class="action-buttons">
                      <button (click)="onView(user.id)" class="btn btn-icon btn-primary" title="View" data-bs-toggle="tooltip">
                        <i class="bi bi-eye"></i>
                      </button>
                      <button (click)="onEdit(user.id)" class="btn btn-icon btn-info" title="Edit" data-bs-toggle="tooltip">
                        <i class="bi bi-pencil"></i>
                      </button>
                      <button (click)="deleteUser(user.id)" class="btn btn-icon btn-danger" title="Delete" data-bs-toggle="tooltip">
                        <i class="bi bi-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              }

              @if (users.length === 0) {
                <tr>
                  <td colspan="7" class="text-center py-4 text-muted">
                    No users found
                  </td>
                </tr>
              }
            </tbody>
          </table>
        </div>
      }
    </div>

    <!-- Pagination -->
    @if (paginationConfig.totalPages > 0) {
      <div class="card-footer">
        <app-pagination 
          [config]="paginationConfig"
          (pageChange)="handlePageChange($event)"
          (pageSizeChange)="selectPageSize($event)">
        </app-pagination>
      </div>
    }
  </div>
</div>

<!-- User Detail Modal -->
<app-user-detail-modal #userDetailModal></app-user-detail-modal>
