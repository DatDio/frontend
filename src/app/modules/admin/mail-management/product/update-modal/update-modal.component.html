<div class="modal-overlay">
  <div class="modal-content modal-lg" (click)="$event.stopPropagation()">
    <div class="modal-header">
      <h5 class="modal-title">Cập nhật sản phẩm</h5>
      <button type="button" class="btn-close" (click)="onClose()"></button>
    </div>

    <div class="modal-body">
      <form [formGroup]="updateForm">
        <div class="row">
          <!-- Image upload column -->
          <div class="col-md-4 mb-3">
            <label class="form-label">Ảnh sản phẩm</label>
            <div class="image-upload-container">
              <div class="image-preview-wrapper" *ngIf="imagePreview">
                <img [src]="imagePreview" alt="Preview" class="image-preview">
                <button type="button" class="btn btn-sm btn-danger remove-btn" (click)="removeImage()">
                  <i class="bi bi-x"></i>
                </button>
              </div>
              <div class="upload-area" *ngIf="!imagePreview">
                <input type="file" id="updateProductImage" class="d-none"
                  accept="image/jpeg,image/png,image/gif,image/webp,image/svg+xml" (change)="onImageSelected($event)">
                <label for="updateProductImage" class="upload-label">
                  <i class="bi bi-cloud-upload fs-2"></i>
                  <span class="d-block mt-2">Chọn ảnh</span>
                  <small class="text-muted">JPG, PNG (tối đa 5MB)</small>
                </label>
              </div>
              <div class="mt-2 text-center" *ngIf="imagePreview">
                <input type="file" id="changeUpdateProductImage" class="d-none"
                  accept="image/jpeg,image/png,image/gif,image/webp,image/svg+xml" (change)="onImageSelected($event)">
                <label for="changeUpdateProductImage" class="btn btn-sm btn-outline-primary">Đổi ảnh</label>
              </div>
            </div>
          </div>

          <!-- Form fields column -->
          <div class="col-md-8">
            <div class="mb-3">
              <label for="name" class="form-label">Tên sản phẩm <span class="text-danger">*</span></label>
              <input id="name" type="text" class="form-control" formControlName="name"
                placeholder="Nhập tên sản phẩm...">
              @if (updateForm.get('name')?.invalid && updateForm.get('name')?.touched) {
              <div class="text-danger small mt-1">Tên phải ít nhất 3 ký tự</div>
              }
            </div>

            <div class="mb-3">
              <label for="description" class="form-label">Mô tả</label>
              <textarea id="description" class="form-control" formControlName="description" rows="2"
                placeholder="Nhập mô tả sản phẩm..."></textarea>
            </div>

            <div class="row">
              <div class="col-md-6 mb-3">
                <label for="price" class="form-label">Giá <span class="text-danger">*</span></label>
                <input id="price" type="number" class="form-control" formControlName="price" placeholder="Nhập giá..."
                  min="1">
                @if (updateForm.get('price')?.invalid && updateForm.get('price')?.touched) {
                <div class="text-danger small mt-1">Giá phải lớn hơn 0</div>
                }
              </div>

              <div class="col-md-6 mb-3">
                <label for="categoryId" class="form-label">Danh mục <span class="text-danger">*</span></label>
                <select id="categoryId" class="form-select" formControlName="categoryId">
                  <option value="">-- Chọn danh mục --</option>
                  @for (category of categories; track category.id) {
                  <option [value]="category.id">{{ category.name }}</option>
                  }
                </select>
              </div>
            </div>

            <div class="row">
              <div class="col-md-4 mb-3">
                <label for="liveTime" class="form-label">LiveTime</label>
                <input id="liveTime" type="text" class="form-control" formControlName="liveTime"
                  placeholder="Ví dụ: 3-5h">
              </div>

              <div class="col-md-4 mb-3">
                <label for="country" class="form-label">Quốc gia</label>
                <input id="country" type="text" class="form-control" formControlName="country" placeholder="VN">
              </div>

              <div class="col-md-4 mb-3">
                <label for="status" class="form-label">Trạng thái</label>
                <select id="status" class="form-select" formControlName="status">
                  <option value="1">Hoạt động</option>
                  <option value="0">Không hoạt động</option>
                </select>
              </div>
            </div>

            <div class="mb-3">
              <label for="sortOrder" class="form-label">Thứ tự hiển thị (STT)</label>
              <input id="sortOrder" type="number" class="form-control" formControlName="sortOrder"
                placeholder="Nhập số thứ tự (số nhỏ hiển thị trước)" min="0">
              <small class="text-muted">Số nhỏ hơn sẽ hiển thị trước. Mặc định là 0.</small>
            </div>

            <!-- Cấu hình kho phụ -->
            <div class="row">
              <div class="col-12 mb-2">
                <label class="form-label fw-bold text-primary">
                  <i class="bi bi-box-seam me-1"></i> Cấu hình kho phụ
                </label>
                <small class="text-muted d-block">Thiết lập số lượng hiển thị cho khách hàng</small>
              </div>
              <div class="col-md-6 mb-3">
                <label for="minSecondaryStock" class="form-label">SL tối thiểu</label>
                <input id="minSecondaryStock" type="number" class="form-control" formControlName="minSecondaryStock"
                  placeholder="Ngưỡng trigger chuyển kho" min="0">
                <small class="text-muted">Khi kho phụ dưới mức này sẽ tự động bổ sung từ kho chính</small>
              </div>
              <div class="col-md-6 mb-3">
                <label for="maxSecondaryStock" class="form-label">SL tối đa</label>
                <input id="maxSecondaryStock" type="number" class="form-control" formControlName="maxSecondaryStock"
                  placeholder="Số lượng hiển thị tối đa" min="1">
                <small class="text-muted">Số lượng tối đa hiển thị cho khách hàng</small>
              </div>
            </div>
          </div>
        </div>
      </form>
    </div>

    <div class="modal-footer">
      <button type="button" class="btn btn-secondary" (click)="onClose()">Hủy</button>
      <button type="button" class="btn btn-primary" (click)="onSubmit()" [disabled]="isLoading">
        @if (isLoading) {
        <span class="spinner-border spinner-border-sm me-2"></span>
        }
        Cập nhật sản phẩm
      </button>
    </div>
  </div>
</div>