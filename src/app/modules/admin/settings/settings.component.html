<div class="settings-container">
    <div class="card">
        <div class="card-header">
            <h5 class="mb-0">
                <i class="bi bi-gear me-2"></i>
                Cài đặt hệ thống
            </h5>
        </div>
        <div class="card-body">
            <!-- Loading -->
            <div *ngIf="loading" class="text-center py-5">
                <div class="spinner-border text-primary" role="status">
                    <span class="visually-hidden">Đang tải...</span>
                </div>
                <p class="mt-2 text-muted">Đang tải cài đặt...</p>
            </div>

            <!-- Settings Content -->
            <div *ngIf="!loading">
                <!-- Rank Settings Section -->
                <div class="settings-section">
                    <h6 class="section-title">
                        <i class="bi bi-trophy me-2"></i>
                        Cài đặt Thứ hạng
                    </h6>

                    <div class="setting-item">
                        <div class="setting-info">
                            <label class="setting-label">Số ngày tính hạng</label>
                            <p class="setting-description text-muted mb-0">
                                Hệ thống sẽ tính tổng số tiền nạp trong khoảng thời gian này để xác định thứ hạng của
                                người dùng.
                            </p>
                        </div>
                        <div class="setting-control">
                            <div class="input-group" style="width: 150px;">
                                <input type="number" class="form-control" [(ngModel)]="rankPeriodDays" min="1" max="365"
                                    placeholder="7">
                                <span class="input-group-text">ngày</span>
                            </div>
                            <button class="btn btn-primary btn-sm ms-2" (click)="saveRankPeriodDays()">
                                <i class="bi bi-check-lg me-1"></i>
                                Lưu
                            </button>
                        </div>
                    </div>
                </div>

                <!-- PayOS Settings Section -->
                <div class="settings-section mt-4">
                    <h6 class="section-title">
                        <i class="bi bi-credit-card me-2"></i>
                        Cấu hình Thanh toán PayOS
                        <span class="badge bg-secondary ms-2">Ẩn - Đang dùng Casso</span>
                    </h6>
                    <p class="text-muted small mb-3">
                        Nhập thông tin xác thực PayOS để kích hoạt thanh toán. Nếu để trống, hệ thống sẽ sử dụng giá trị
                        từ biến môi trường.
                    </p>

                    <div class="row g-3">
                        <div class="col-md-4">
                            <label class="form-label">Client ID</label>
                            <input type="text" class="form-control" [(ngModel)]="payosClientId"
                                placeholder="Nhập PayOS Client ID...">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">API Key</label>
                            <input type="password" class="form-control" [(ngModel)]="payosApiKey"
                                placeholder="Nhập PayOS API Key...">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Checksum Key</label>
                            <input type="password" class="form-control" [(ngModel)]="payosChecksumKey"
                                placeholder="Nhập PayOS Checksum Key...">
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-secondary" (click)="savePayOSSettings()" [disabled]="payosSaving">
                            <i class="bi bi-check-lg me-1" *ngIf="!payosSaving"></i>
                            <span class="spinner-border spinner-border-sm me-1" *ngIf="payosSaving"></span>
                            {{ payosSaving ? 'Đang lưu...' : 'Lưu cấu hình PayOS' }}
                        </button>
                    </div>
                </div>

                <!-- Casso Settings Section -->
                <div class="settings-section mt-4">
                    <h6 class="section-title">
                        <i class="bi bi-qr-code me-2"></i>
                        Cấu hình Thanh toán Casso (VietQR)
                        <span class="badge bg-success ms-2">Đang sử dụng</span>
                    </h6>
                    <p class="text-muted small mb-3">
                        Nhập thông tin ngân hàng để nhận tiền qua chuyển khoản VietQR.
                        Secure Token dùng để xác thực webhook callback từ Casso.
                    </p>

                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">Secure Token (Webhook)</label>
                            <input type="password" class="form-control" [(ngModel)]="cassoSecureToken"
                                placeholder="Nhập Secure Token từ Casso...">
                            <small class="text-muted">Để xác thực webhook callback từ Casso</small>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Mã Ngân Hàng</label>
                            <select class="form-select" [(ngModel)]="cassoBankCode">
                                <option value="">-- Chọn ngân hàng --</option>
                                <option value="ACB">ACB - Ngân hàng Á Châu</option>
                                <option value="VCB">VCB - Vietcombank</option>
                                <option value="TCB">TCB - Techcombank</option>
                                <option value="MB">MB - Quân Đội</option>
                                <option value="VPB">VPB - VPBank</option>
                                <option value="TPB">TPB - TPBank</option>
                                <option value="BIDV">BIDV</option>
                                <option value="VTB">VTB - Vietinbank</option>
                                <option value="STB">STB - Sacombank</option>
                                <option value="MSB">MSB - Maritime Bank</option>
                                <option value="HDB">HDB - HDBank</option>
                                <option value="OCB">OCB - Phương Đông</option>
                                <option value="SHB">SHB - Sài Gòn Hà Nội</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Số Tài Khoản</label>
                            <input type="text" class="form-control" [(ngModel)]="cassoBankAccount"
                                placeholder="VD: 123456789">
                        </div>
                        <div class="col-md-6">
                            <label class="form-label">Tên Chủ Tài Khoản</label>
                            <input type="text" class="form-control" [(ngModel)]="cassoAccountName"
                                placeholder="VD: NGUYEN VAN A (không dấu, viết hoa)">
                            <small class="text-muted">Không dấu, viết hoa toàn bộ</small>
                        </div>
                    </div>
                    <div class="mt-3">
                        <button class="btn btn-primary" (click)="saveCassoSettings()" [disabled]="cassoSaving">
                            <i class="bi bi-check-lg me-1" *ngIf="!cassoSaving"></i>
                            <span class="spinner-border spinner-border-sm me-1" *ngIf="cassoSaving"></span>
                            {{ cassoSaving ? 'Đang lưu...' : 'Lưu cấu hình Casso' }}
                        </button>
                    </div>
                </div>

                <!-- All Settings Table -->
                <div class="settings-section mt-4" *ngIf="settings.length > 0">
                    <h6 class="section-title">
                        <i class="bi bi-list-ul me-2"></i>
                        Tất cả cài đặt
                    </h6>

                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>Key</th>
                                    <th>Giá trị</th>
                                    <th>Mô tả</th>
                                    <th style="width: 120px;">Thao tác</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr *ngFor="let setting of settings">
                                    <td>
                                        <code>{{ setting.settingKey }}</code>
                                    </td>
                                    <td>
                                        <ng-container *ngIf="editingKey !== setting.settingKey">
                                            {{ setting.settingValue }}
                                        </ng-container>
                                        <input *ngIf="editingKey === setting.settingKey" type="text"
                                            class="form-control form-control-sm" [(ngModel)]="editValue">
                                    </td>
                                    <td class="text-muted">{{ setting.description }}</td>
                                    <td>
                                        <ng-container *ngIf="editingKey !== setting.settingKey">
                                            <button class="btn btn-sm btn-outline-primary" (click)="startEdit(setting)"
                                                title="Sửa">
                                                <i class="bi bi-pencil"></i>
                                            </button>
                                        </ng-container>
                                        <ng-container *ngIf="editingKey === setting.settingKey">
                                            <button class="btn btn-sm btn-success me-1" (click)="saveEdit(setting)"
                                                title="Lưu">
                                                <i class="bi bi-check-lg"></i>
                                            </button>
                                            <button class="btn btn-sm btn-secondary" (click)="cancelEdit()" title="Hủy">
                                                <i class="bi bi-x-lg"></i>
                                            </button>
                                        </ng-container>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Empty State -->
                <div *ngIf="settings.length === 0" class="text-center py-4 text-muted">
                    <i class="bi bi-inbox fs-1"></i>
                    <p class="mt-2">Chưa có cài đặt nào</p>
                </div>
            </div>
        </div>
    </div>
</div>